name: OPA Validation

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  opa-check:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Run OPA Validate
        uses: open-policy-agent/opa-docker-action@v1.0.0
        with:
          args: "eval -f pretty --data rego/all.rego --input namespace.json data.kubernetes.admission.deny"
